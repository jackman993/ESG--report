# ESG å ±å‘Šç”Ÿæˆç³»çµ± - å·¥ä½œæµç¨‹èˆ‡ä¿®æ”¹æ‘˜è¦

## ğŸ“ å°ˆæ¡ˆè·¯å¾‘
```
C:\Users\User\Desktop\ESG report\ESG--report\
```

## ğŸ”§ ä¸»è¦ä¿®æ”¹æ–‡ä»¶

### 1. å…¬å¸æ®µèˆ‡æ²»ç†ç¤¾æœƒæ®µ Prompt ä¿®æ”¹
**æ–‡ä»¶è·¯å¾‘ï¼š** `company1.1-3.6/content_pptx_company.py`

**ä¿®æ”¹å…§å®¹ï¼š**
- ç‚º 10 å€‹å‡½æ•¸æ·»åŠ ç”¢æ¥­ç‰¹æ€§è¦æ±‚
- æ·»åŠ  `_format_expert_intro()` è¼”åŠ©å‡½æ•¸ï¼Œæ­£ç¢ºè™•ç†ç©ºç”¢æ¥­åˆ¥
- æ·»åŠ èª¿è©¦ä¿¡æ¯ï¼Œè¿½è¹¤ç”¢æ¥­åˆ¥æ˜¯å¦æˆåŠŸåŒ…å«åœ¨ prompt ä¸­

**ä¿®æ”¹çš„å‡½æ•¸ï¼š**
1. `generate_governance_overview` (ç¬¬37é  5.1) - æ²»ç†æ¦‚è¦½
2. `generate_legal_alignment_overview` (ç¬¬39é  5.3) - æ³•è¦å°é½Šæ¦‚è¦½
3. `generate_legal_appliance_overview` (ç¬¬40é  5.4) - æ³•å¾‹éµå¾ª
4. `generate_social_health_safety` (ç¬¬46é  6.2) - å“¡å·¥å¥åº·å®‰å…¨
5. `generate_social_action_plan_overview` (ç¬¬49é  6.5) - ç¤¾æœƒè¡Œå‹•è¨ˆç•«
6. `generate_social_product_responsibility` (ç¬¬52é  6.8) - ç”¢å“è²¬ä»»
7. `generate_social_customer_welfare` (ç¬¬52é  6.8) - å®¢æˆ¶ç¦ç¥‰
8. `generate_stakeholder_analysis` (ç¬¬9é  2.1) - åˆ©å®³é—œä¿‚äººåˆ†æ
9. `generate_sdg_summary` (ç¬¬15é  3.4) - SDG æ‘˜è¦
10. `generate_cooperation_info` (ç¬¬2é  1.1) - å…¬å¸ä»‹ç´¹ï¼ˆå·²æœ‰ç”¢æ¥­ç‰¹æ€§è¦æ±‚ï¼‰

### 2. Log è®€å–æ”¹é€²
**æ–‡ä»¶è·¯å¾‘ï¼š** `company1.1-3.6/env_log_reader.py`

**ä¿®æ”¹å…§å®¹ï¼š**
- æ”¹é€² `load_latest_environment_log()` å‡½æ•¸
  - å¾åŒä¸€å€‹ session çš„æ‰€æœ‰ log æ–‡ä»¶åˆä½µè³‡æ–™
  - è‹¥åŒä¸€å€‹ session ç¼ºå°‘è³‡æ–™ï¼Œå¾æœ€è¿‘çš„åŒ…å«å®Œæ•´è³‡æ–™çš„æ–‡ä»¶ä¸­ç²å–
  - æ”¯æ´å¾ `emission_data` å’Œ `emission_result` å…©ç¨®æ ¼å¼è®€å–æ’æ”¾è³‡æ–™
- ä¿®æ­£ `_standardize_log_data()` å‡½æ•¸
  - å°‡ç”¢æ¥­åˆ¥çš„é»˜èªå€¼å¾ `"General Industry"` æ”¹ç‚ºç©ºå­—ä¸² `""`
- æ”¹é€² `get_prompt_context()` å‡½æ•¸
  - æ·»åŠ èª¿è©¦ä¿¡æ¯ï¼Œç¢ºèªç”¢æ¥­åˆ¥æ˜¯å¦æˆåŠŸæå–

### 3. Sidebar é‡æ–°é–‹å§‹åŠŸèƒ½
**æ–‡ä»¶è·¯å¾‘ï¼š** `TCFD generator/shared/utils.py`

**ä¿®æ”¹å…§å®¹ï¼š**
- æ·»åŠ  `clear_all_data()` å‡½æ•¸ï¼Œæ¸…é™¤æ‰€æœ‰å‰æ¬¡è³‡æ–™
- åœ¨ `render_sidebar_navigation()` ä¸­æ·»åŠ ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•
- å¯¦ç¾ç¢ºèªå°è©±æ¡†ï¼Œé¿å…èª¤æ“ä½œ

## ğŸ“Š Log æ–‡ä»¶è·¯å¾‘
```
C:\Users\User\Desktop\ESG_Output\_Backend\user_logs\
```

**Log æ–‡ä»¶çµæ§‹ï¼š**
- Step 1 æ–‡ä»¶åŒ…å«ï¼š`industry`, `company_profile`, `emission_data`
- Step 2/3 æ–‡ä»¶é€šå¸¸ä¸åŒ…å« `industry`
- ç³»çµ±æœƒå¾ Step 1 æ–‡ä»¶ä¸­åˆä½µç”¢æ¥­åˆ¥åˆ°æœ€æ–°æ–‡ä»¶

## ğŸ” ç”¢æ¥­åˆ¥è®€å–æµç¨‹

1. **`load_latest_environment_log()`** 
   - è®€å–æœ€æ–°çš„ log æ–‡ä»¶
   - å¾åŒä¸€å€‹ session çš„å…¶ä»–æ–‡ä»¶ä¸­åˆä½µç”¢æ¥­åˆ¥
   - è‹¥ä»ç¼ºå°‘ï¼Œå¾æœ€è¿‘çš„åŒ…å«ç”¢æ¥­åˆ¥çš„æ–‡ä»¶ä¸­ç²å–

2. **`_standardize_log_data()`**
   - å°‡åŸå§‹ log è³‡æ–™è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
   - æå– `industry` æ¬„ä½ï¼ˆå¦‚æœæ²’æœ‰å‰‡ç‚ºç©ºå­—ä¸²ï¼‰

3. **`get_prompt_context()`**
   - å¾æ¨™æº–åŒ–çš„ log_data ä¸­æå–ç”¢æ¥­åˆ¥
   - è¿”å›åŒ…å« `industry` çš„ context dict

4. **`PPTContentEngine.__init__()`**
   - èª¿ç”¨ `load_latest_environment_log()` è¼‰å…¥ log
   - èª¿ç”¨ `get_prompt_context()` ç²å– context
   - å­˜å„²åœ¨ `self.env_context` ä¸­

5. **å„ç”Ÿæˆå‡½æ•¸**
   - å¾ `self.env_context.get("industry", "")` ç²å–ç”¢æ¥­åˆ¥
   - ä½¿ç”¨ `_format_expert_intro()` æ ¼å¼åŒ–å°ˆå®¶ä»‹ç´¹
   - åœ¨ prompt ä¸­åŒ…å«ç”¢æ¥­åˆ¥è¦æ±‚

## âš ï¸ å·²çŸ¥å•é¡Œ

### å•é¡Œï¼šLLM æ²’æœ‰èªªå‡ºå’Œç”¢æ¥­ç›¸é—œçš„æ–‡å¥

**å¯èƒ½åŸå› ï¼š**
1. åœ¨å¯¦éš›é‹è¡Œæ™‚ï¼Œlog æ–‡ä»¶å¯èƒ½æ²’æœ‰æˆåŠŸè®€å–ç”¢æ¥­åˆ¥
2. ç”¢æ¥­åˆ¥é›–ç„¶åœ¨ prompt ä¸­ï¼Œä½† LLM æ²’æœ‰å……åˆ†ä½¿ç”¨

**èª¿è©¦æ–¹æ³•ï¼š**
- æª¢æŸ¥æ§åˆ¶å°è¼¸å‡ºä¸­çš„ `[DEBUG]` å’Œ `[INFO]` è¨Šæ¯
- ç¢ºèªæ˜¯å¦æœ‰ `[WARN]` æˆ– `[ERROR]` è¨Šæ¯
- æª¢æŸ¥ `[INFO] Industry: xxx` æ˜¯å¦é¡¯ç¤ºæ­£ç¢ºçš„ç”¢æ¥­åˆ¥

**æ¸¬è©¦è…³æœ¬ï¼š**
```python
from env_log_reader import load_latest_environment_log, get_prompt_context
from content_pptx_company import PPTContentEngine

# æ¸¬è©¦ log è®€å–
log_data = load_latest_environment_log()
print(f"Log industry: {log_data.get('industry') if log_data else 'None'}")

# æ¸¬è©¦ context
context = get_prompt_context(log_data)
print(f"Context industry: {context.get('industry')}")

# æ¸¬è©¦å¯¦éš›ä½¿ç”¨
engine = PPTContentEngine()
print(f"Engine industry: {engine.env_context.get('industry')}")
```

## ğŸ“ é—œéµä»£ç¢¼ä½ç½®

### ç”¢æ¥­åˆ¥è®€å–
- `env_log_reader.py:33-199` - `load_latest_environment_log()`
- `env_log_reader.py:202-283` - `_standardize_log_data()`
- `env_log_reader.py:286-338` - `get_prompt_context()`

### Prompt ç”Ÿæˆ
- `content_pptx_company.py:67-82` - `_format_expert_intro()` è¼”åŠ©å‡½æ•¸
- `content_pptx_company.py:84-115` - `_call()` æ–¹æ³•ï¼ˆåŒ…å«èª¿è©¦ä¿¡æ¯ï¼‰
- `content_pptx_company.py:175-194` - `generate_governance_overview()` ç¯„ä¾‹

### Sidebar åŠŸèƒ½
- `TCFD generator/shared/utils.py:18-48` - `clear_all_data()` å‡½æ•¸
- `TCFD generator/shared/utils.py:50-120` - `render_sidebar_navigation()` å‡½æ•¸

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè­°

1. **æª¢æŸ¥å¯¦éš›é‹è¡Œæ™‚çš„ log è¼¸å‡º**
   - ç¢ºèªæ˜¯å¦æœ‰ `[INFO] Industry: xxx` è¨Šæ¯
   - ç¢ºèªæ˜¯å¦æœ‰ `[WARN]` æˆ– `[ERROR]` è¨Šæ¯

2. **æª¢æŸ¥å¯¦éš›ç”Ÿæˆçš„ prompt**
   - åœ¨ `_call()` æ–¹æ³•ä¸­å·²æœ‰èª¿è©¦ä¿¡æ¯
   - ç¢ºèªç”¢æ¥­åˆ¥æ˜¯å¦çœŸçš„åŒ…å«åœ¨ç™¼é€çµ¦ LLM çš„ prompt ä¸­

3. **å¦‚æœç”¢æ¥­åˆ¥ç¢ºå¯¦å­˜åœ¨ä½† LLM æ²’æœ‰ä½¿ç”¨**
   - å¯èƒ½éœ€è¦åŠ å¼· prompt ä¸­å°ç”¢æ¥­åˆ¥çš„è¦æ±‚
   - æˆ–è€…æª¢æŸ¥ LLM çš„å›æ‡‰æ˜¯å¦çœŸçš„å¿½ç•¥äº†ç”¢æ¥­åˆ¥

