# 日誌功能說明

## 📋 日誌的作用

### 1. **問題診斷與除錯** 🔍

當系統在 Streamlit Cloud 上運行時，如果發生錯誤，您無法直接看到控制台輸出。日誌可以幫助您：

- **追蹤錯誤發生位置**：知道錯誤發生在哪個步驟
- **查看完整錯誤堆疊**：了解錯誤的完整上下文
- **檢查狀態變化**：確認 sys.path、config 等狀態是否正確恢復

**實際案例**：
```
2025-12-24 09:57:47,210 - company_engine_wrapper_zh - ERROR - 生成公司段失敗: Error code: 401
Traceback (most recent call last):
  File "...company_engine_wrapper_zh.py", line 101, in generate_company_section_zh
    output_path = ppt_engine.generate(company_name=company_name)
```
→ 這告訴您錯誤發生在 `ppt_engine.generate()` 調用時，是 API 認證問題（401）

### 2. **監控系統運行狀態** 📊

在 Streamlit Cloud 上，您可以通過日誌監控：

- **執行流程**：確認每個步驟是否正常執行
- **性能指標**：了解每個步驟的執行時間
- **資源使用**：追蹤記憶體、路徑等資源變化

**實際案例**：
```
2025-12-24 09:57:43,500 - company_engine_wrapper_zh - INFO - 開始生成公司段 PPTX
2025-12-24 09:57:43,500 - company_engine_wrapper_zh - INFO - 載入公司段引擎: C:\Users\User\Desktop\ESG report\ESG--report\company1.1-3.6
2025-12-24 09:57:44,850 - company_engine_wrapper_zh - INFO - 初始化內容引擎...
```
→ 這告訴您系統正在按預期流程執行

### 3. **確保狀態恢復** ✅

日誌記錄了狀態恢復過程，確保：

- **sys.path 恢復**：避免影響其他模組的導入
- **config 恢復**：確保 API Key 等配置不會洩漏
- **環境清理**：確認 finally 區塊正確執行

**實際案例**：
```
2025-12-24 09:57:47,211 - company_engine_wrapper_zh - INFO - 環境狀態恢復完成
```
→ 這告訴您即使發生錯誤，環境狀態也已正確恢復

### 4. **用戶體驗改善** 🎯

當用戶在 Streamlit 上使用時：

- **清晰的錯誤訊息**：日誌幫助生成更友好的錯誤提示
- **進度追蹤**：可以顯示當前執行到哪個步驟
- **問題回報**：用戶可以複製日誌內容回報問題

## 🎯 在 Streamlit Cloud 上的實際價值

### 問題場景

**沒有日誌時**：
- ❌ 用戶只看到 "生成失敗"
- ❌ 不知道失敗原因
- ❌ 無法診斷問題
- ❌ 無法修復

**有日誌時**：
- ✅ 可以看到完整的錯誤堆疊
- ✅ 知道錯誤發生在哪個步驟
- ✅ 可以追蹤狀態變化
- ✅ 可以快速定位和修復問題

### Streamlit Cloud 日誌查看方式

1. **Streamlit Cloud Dashboard**：
   - 登入 Streamlit Cloud
   - 選擇您的應用
   - 點擊 "Logs" 標籤
   - 查看實時日誌輸出

2. **日誌級別**：
   - `INFO`：一般資訊（執行步驟）
   - `WARNING`：警告（格式問題等）
   - `ERROR`：錯誤（失敗原因）
   - `DEBUG`：詳細調試資訊（開發時使用）

## 📝 日誌記錄的關鍵資訊

### 當前記錄的內容：

1. **輸入驗證**：
   ```
   ERROR - API Key 驗證失敗：API Key 不能為空
   WARNING - API Key 格式可能不正確（應以 sk-ant- 開頭）
   ```

2. **執行流程**：
   ```
   INFO - 開始生成公司段 PPTX
   INFO - 載入公司段引擎: [路徑]
   INFO - 初始化內容引擎...
   INFO - 初始化 PPT 引擎...
   INFO - 開始生成 PPTX...
   ```

3. **錯誤處理**：
   ```
   ERROR - 生成公司段失敗: [錯誤訊息]
   [完整堆疊追蹤]
   ```

4. **狀態恢復**：
   ```
   DEBUG - 開始恢復環境狀態...
   DEBUG - 已恢復 API Key
   DEBUG - 已恢復輸出路徑
   DEBUG - 已恢復 sys.path（長度: X）
   INFO - 環境狀態恢復完成
   ```

## 🔧 如何查看日誌

### 本地測試時：
- 控制台直接輸出
- 測試腳本會生成 `test_wrappers.log` 文件

### Streamlit Cloud 上：
- 登入 Streamlit Cloud Dashboard
- 查看應用日誌
- 或使用 Streamlit 的日誌查看功能

## 💡 總結

日誌不是「可有可無」的功能，而是：

1. **生產環境必備**：Streamlit Cloud 上無法直接調試，必須依賴日誌
2. **問題診斷工具**：快速定位和修復問題
3. **系統監控手段**：了解系統運行狀態
4. **用戶體驗保障**：提供清晰的錯誤訊息

**沒有日誌 = 盲人摸象**  
**有日誌 = 有完整的診斷工具**

